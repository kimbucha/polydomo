(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function n(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach((function(e){r(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function r(e,n,r){return(n=function(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,n||"default");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}console.log("Background script loaded"),chrome.runtime.onInstalled.addListener((function(){console.log("Extension installed/updated")}));var o=null,s={timeLeft:1500,isRunning:!1,isBreak:!1,isCompleted:!1,currentTask:"",subTasks:[],stats:{focusMinutes:0,completedPomodoros:0,currentStreak:0,dailyStats:{date:(new Date).toDateString(),focusMinutes:0,completedPomodoros:0,breaks:0}},settings:{focusDuration:25,breakDuration:5,dailyGoal:8,popupOnComplete:!0}},i=new Set;chrome.runtime.onConnect.addListener((function(t){console.log("New connection established"),i.add(t),t.onDisconnect.addListener((function(){i.delete(t)})),t.onMessage.addListener((function(e){return function(t,e){switch(console.log("Background received message:",t),t.action){case"getState":e.postMessage({type:"STATE_UPDATE",state:s});break;case"startTimer":console.log("Starting timer with task:",t.task);var r=u(t.task,t.focusDuration);e.postMessage({type:"TIMER_RESPONSE",success:r});break;case"resetTimer":clearInterval(o),o=null,s.isRunning=!1,s.isCompleted=!1,s.timeLeft=60*s.settings.focusDuration,l(),a(),d(),e.postMessage({type:"TIMER_RESPONSE",success:!0});break;case"startBreak":console.log("Starting break with settings:",t.settings),clearInterval(o),s.isBreak=!0,s.timeLeft=60*t.settings.breakDuration,s.isRunning=!0,s.isCompleted=!1,o=c(),l(),a(),d(),e.postMessage({type:"TIMER_RESPONSE",success:!0});break;case"addSubTask":s.subTasks.push(t.task),a(),d(),e.postMessage({type:"TIMER_RESPONSE",success:!0});break;case"switchTask":t.previousTask&&s.subTasks.push(t.previousTask),s.currentTask=t.task,a(),d(),e.postMessage({type:"TIMER_RESPONSE",success:!0});break;case"updateSettings":s.settings=n(n({},s.settings),t.settings),s.isRunning||(s.timeLeft=s.isBreak?60*s.settings.breakDuration:60*s.settings.focusDuration),a(),d(),e.postMessage({type:"TIMER_RESPONSE",success:!0})}}(e,t)}))}));var a=function(){var t={type:"STATE_UPDATE",state:{timeLeft:s.timeLeft,isRunning:s.isRunning,isBreak:s.isBreak,isCompleted:s.isCompleted,currentTask:s.currentTask,subTasks:s.subTasks,stats:s.stats}};i.forEach((function(e){try{e.postMessage(t)}catch(t){console.error("Error broadcasting to port:",t)}}))};setInterval((function(){chrome.runtime.getPlatformInfo((function(){chrome.runtime.lastError}))}),2e4),chrome.storage.local.get(["timerState"],(function(t){if(t.timerState){var e=t.timerState,n=Date.now(),r=n-(e.lastSaved||n);if(e.isRunning){var i=Math.floor(r/1e3);e.timeLeft=Math.max(0,e.timeLeft-i),0===e.timeLeft&&(e.isRunning=!1,e.isCompleted=!0)}s=e}s.isRunning||s.isCompleted||(s.timeLeft=s.isBreak?60*s.settings.breakDuration:60*s.settings.focusDuration,s.isBreak=!1),s.isRunning&&(o=c()),a()}));var c=function(){try{return o&&clearInterval(o),setInterval((function(){s.timeLeft>0?(s.timeLeft--,l(),a()):g()}),1e3)}catch(t){return console.error("Error setting up timer:",t),null}},u=function(t,e){return console.log("Background: Starting timer with task:",t),s.subTasks=[],s.isRunning?(console.log("Timer already running"),!1):(clearInterval(o),m(),s.currentTask=t,s.timeLeft=s.isBreak?60*s.settings.breakDuration:60*e,s.isRunning=!0,s.isCompleted=!1,l(),o=c(),!0)},l=function(){try{var t=Math.floor(s.timeLeft/60),e=s.timeLeft%60,n="".concat(t,":").concat(e.toString().padStart(2,"0"));chrome.action.setBadgeText({text:n}).catch((function(){})),chrome.action.setBadgeBackgroundColor({color:s.isBreak?"#4CAF50":"#FF6B6B"}).catch((function(){}))}catch(t){console.log("Error updating badge:",t)}},m=function(){try{var t=s.isRunning?s.isBreak?chrome.runtime.getURL("icons/break_active_icon.png"):chrome.runtime.getURL("icons/active_icon128.png"):s.isBreak?chrome.runtime.getURL("icons/break_inactive_icon.png"):chrome.runtime.getURL("icons/inactive_icon128.png");chrome.action.setIcon({path:t}).catch((function(t){return console.error("Icon update failed:",t)})),chrome.action.setBadgeBackgroundColor({color:s.isBreak?"#4CAF50":"#F44336"}).catch((function(){}))}catch(t){console.error("Error updating icon:",t)}},g=function(){clearInterval(o),s.isRunning=!1,s.isCompleted=!0;var t=s.isBreak?chrome.runtime.getURL("icons/break_inactive_icon.png"):chrome.runtime.getURL("icons/smile_icon128.png");chrome.action.setIcon({path:t}).catch((function(){})),s.isBreak?chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon128.png"),title:"Break Time Over",message:"Ready to focus again?"}).catch((function(){})):(f(),chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/smile_icon128.png"),title:"Focus Session Complete!",message:'Great job focusing on "'.concat(s.currentTask,'"!')}).catch((function(){})),s.settings.popupOnComplete&&chrome.windows.getCurrent((function(t){chrome.action.openPopup().catch((function(){}))}))),chrome.action.setBadgeText({text:""}).catch((function(){})),a(),d()},f=function(){var t=(new Date).toDateString();s.stats.dailyStats&&s.stats.dailyStats.date===t||(s.stats.dailyStats={date:t,focusMinutes:0,completedPomodoros:0,breaks:0}),s.stats.dailyStats.focusMinutes+=s.settings.focusDuration,s.stats.dailyStats.completedPomodoros++,p(),d()},p=function(){var t=new Date,e=t.toDateString();if(s.stats.lastCompleted===e)s.stats.currentStreak++;else if(s.stats.lastCompleted){var n=(t-new Date(s.stats.lastCompleted))/864e5;s.stats.currentStreak=n>1?1:s.stats.currentStreak+1}else s.stats.currentStreak=1;s.stats.lastCompleted=e},d=function(){chrome.storage.local.set({timerState:n(n({},s),{},{lastSaved:Date.now()})}).catch((function(t){console.error("Error saving state:",t)}))};chrome.runtime.onSuspend.addListener((function(){clearInterval(o),d()}))})();
//# sourceMappingURL=background.js.map